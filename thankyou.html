<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Merci pour votre achat !</title>

  <!-- Script DataFast -->
  <script
    data-website-id="683f535ef1a0753281970df8"
    data-domain="toolmonsters-lab.com"
    src="https://datafa.st/js/script.js">
  </script>

  <script>
    window.addEventListener('load', () => {
      const params = new URLSearchParams(window.location.search);
      
      // R√©cup√©ration de tous les param√®tres critiques
      const purchaseData = {
        email: params.get("email"),
        amount: parseFloat(params.get("amount")) || 0,
        currency: params.get("currency") || "EUR",
        visitor_id: params.get("datafast_visitor_id"),
        session_id: params.get("datafast_session_id"),
        ref: params.get("ref")
      };

      console.log("üîç Param√®tres d√©tect√©s :", purchaseData);

      const interval = setInterval(() => {
        if (typeof window.datafast === "function") {
          try {
            // Conversion du montant en cents
            const amountInCents = Math.round(purchaseData.amount * 100);
            
            window.datafast("payment", {
              email: purchaseData.email,
              amount: amountInCents,
              currency: purchaseData.currency.toLowerCase(),
              _visitor_id: purchaseData.visitor_id,
              _session_id: purchaseData.session_id,
              _ref: purchaseData.ref
            });
            
            console.log("‚úÖ √âv√©nement envoy√© √† DataFast :", {
              amount: amountInCents,
              currency: purchaseData.currency,
              email: purchaseData.email,
              ref: purchaseData.ref
            });
          } catch (error) {
            console.error("‚ùå Erreur lors de l'envoi :", error);
          }
          clearInterval(interval);
        }
      }, 200);

      setTimeout(() => {
        if (typeof window.datafast !== "function") {
          console.warn("‚ö†Ô∏è DataFast non d√©tect√© apr√®s 5s");
          clearInterval(interval);
        }
      }, 5000);
    });
  </script>

  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      text-align: center; 
      padding: 4rem;
      background: #f8f9fa;
      color: #2d3436;
    }
    h1 { color: #2ecc71; }
  </style>
</head>
<body>
  <h1>üéâ Achat confirm√© !</h1>
  <p>Un email de confirmation vient d'√™tre envoy√© √† <strong id="email-display"></strong>.</p>
  <p>Merci pour votre confiance üôè</p>

  <script>
    // Affichage dynamique de l'email
    const emailElement = document.getElementById("email-display");
    const urlEmail = new URLSearchParams(window.location.search).get("email");
    if (urlEmail) {
      emailElement.textContent = urlEmail;
    } else {
      emailElement.textContent = "(v√©rifiez votre bo√Æte mail)";
    }
  </script>
</body>
</html>
