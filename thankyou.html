<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Merci pour votre achat !</title>

  <!-- âœ… Script DataFast -->
  <script
    defer
    data-website-id="683f535ef1a0753281970df8"
    data-domain="toolmonsters-lab.com"
    src="https://datafa.st/js/script.js">
  </script>

  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 4rem;
      background: #fff;
    }
  </style>
</head>
<body>
  <h1>âœ… Merci pour votre achat !</h1>
  <p>Votre commande a bien Ã©tÃ© enregistrÃ©e.</p>

  <script>
    const params = new URLSearchParams(window.location.search);
    const email = params.get("email");
    const visitorId = params.get("datafast_visitor_id");
    const sessionId = params.get("datafast_session_id");
    const stripeId = params.get("stripe_payment_id");

    console.log("ðŸ“¦ Email param:", email);
    console.log("ðŸ“¦ Stripe Payment ID:", stripeId);

    // Attendre que le script DataFast soit chargÃ©
    const waitForDatafast = setInterval(() => {
      if (typeof window.datafast === "function") {
        clearInterval(waitForDatafast);
        console.log("âœ… DataFast est prÃªt");

        // âœ… Ã‰tape 1 : reconnecter la session
        window.datafast("identify", {
          visitor_id: visitorId,
          session_id: sessionId
        });

        // âœ… Ã‰tape 2 : envoyer l'Ã©vÃ©nement de paiement avec referrer manuel
        window.datafast("payment", {
          email,
          stripe_payment_id: stripeId,
          referrer: "https://toolmonsters-lab.com"
        });

        console.log("ðŸŽ¯ Ã‰vÃ©nement 'payment' envoyÃ© avec attribution referrer");
      }
    }, 200);
  </script>
</body>
</html>
